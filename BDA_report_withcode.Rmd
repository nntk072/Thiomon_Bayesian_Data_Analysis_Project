---
title: "Thiomon Data Analysis Report"
author: "Anonymous"
output: 
  pdf_document: 
    toc: yes
    toc_depth: 5
bibliography: references.bib 
csl: vancouver.csl
editor_options: 
  chunk_output_type: console
---

```{r include=FALSE}
setwd("/notebooks/bda2024/Bayes_project")
# setwd("C:/Users/nguyenl37/Downloads/Bayes_project/")
# setwd("C:/Users/nguye/OneDrive - Aalto University/University/First year/Project/Bayes_project")
SEED = 42
if (!require(readr)) {
    install.packages("readr")
    library(readr)
}

if (!require(rstan)) {
    install.packages("rstan")
    library(rstan)
}
if (!require(loo)) {
    install.packages("loo")
    library(loo)
}
if (!require(gridExtra)) {
    install.packages("gridExtra")
    library(gridExtra)
}
if (!require(grid)) {
    install.packages("grid")
    library(grid)
}
if (!require(rmarkdown)) {
    install.packages("rmarkdown")
    library(rmarkdown)
}


if (!require(tidybayes)) {
    install.packages("tidybayes")
    library(tidybayes)
}
if (!require(brms)) {
    install.packages("brms")
    library(brms)
}
if (!require(metadat)) {
  install.packages("metadat")
  library(metadat)
}
if(!require(cmdstanr)){
    install.packages("cmdstanr", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
    library(cmdstanr)
}
cmdstan_installed <- function(){
  res <- try(out <- cmdstanr::cmdstan_path(), silent = TRUE)
  !inherits(res, "try-error")
}
if(!cmdstan_installed()){
    install_cmdstan()
}
if(!require(ggplot2)){
    install.packages("ggplot2")
    library(ggplot2)
}
ggplot2::theme_set(theme_minimal(base_size = 14))
if(!require(bayesplot)){
    install.packages("bayesplot")
    library(bayesplot)
}
if(!require(posterior)){
    install.packages("posterior")
    library(posterior)
}
if (!require(priorsense)) {
  install.packages("priorsense")
  library(priorsense)
}
if (!require(tibble)) {
  install.packages("tibble")
  library(tibble)
}
if (!require(RColorBrewer)) {
  install.packages("RColorBrewer")
  library(RColorBrewer)
}
if (!require(dplyr)) {
  install.packages("dplyr")
  library(dplyr)
}
if (!require(tinytable)) {
  install.packages("tinytable")
  library(tinytable)
}
options(tinytable_format_num_fmt = "significant_cell", tinytable_format_digits = 2, tinytable_tt_digits=2)

```


```{r include=FALSE}
suppressPackageStartupMessages(library(aaltobda))
suppressPackageStartupMessages(library(rstan))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(loo))
suppressPackageStartupMessages(library(bayesplot))
suppressPackageStartupMessages(library(gridExtra))
suppressPackageStartupMessages(library(grid))
suppressPackageStartupMessages(library(rmarkdown))
suppressPackageStartupMessages(library(tidybayes))
suppressPackageStartupMessages(library(brms))
suppressPackageStartupMessages(library(metadat))
suppressPackageStartupMessages(library(cmdstanr))
suppressPackageStartupMessages(library(priorsense))
suppressPackageStartupMessages(library(tibble))
suppressPackageStartupMessages(library(RColorBrewer))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(tinytable))
suppressPackageStartupMessages(library(posterior))
```


\newpage

# 1. Introduction


# 2. Data: Thiomon Dataset



## 2.1. Data Preprocessing 
# Load necessary library
```{r}
library(readr)
df <- read_csv('thiomon.csv')
df <- df %>% select(-active)
df <- na.omit(df)
correlation_matrix <- cor(df)
# print(correlation_matrix)
remission_correlation <- abs(correlation_matrix[, 'remission'])
remission_correlation <- sort(remission_correlation, decreasing = TRUE)
print(remission_correlation)
```
This study explores the use of machine learning algorithms for predicting clinical outcomes with thiopurines [@10.1093/ecco-jcc/jjx014].
This study explores the use of machine learning algorithms for predicting clinical outcomes with thiopurines [@10.1093/ecco-jcc/jjx014].

# 3. Models

# 4. Priors

## 4.1. Separate model

## 4.2. Hierarchical model

# 5. Fitting the Stan models

## 5.1. Separate model  

## 5.2. Hierarchical model  

# 6. Convergence diagnostics

## 6.1. $\widehat{R}$

## 6.2. Effective sample size

## 6.3. Divergent transitions  

## 6.4. Conclusion about convergence

## 6.5. Improving convergence

# 7. Posterior predictive checks 

# 8. Model comparison with LOO-CV

# 9. Predictive performance assessment

# 10. Sensitivity analysis

## 10.1. LOO-CV

### 10.1.1. Separate model

### 10.1.2. Hierarchical model

## 10.2. Posterior distributions

# 11. Discussion of issues and potential improvements

# 13. Self-reflection

# Appendix

## A. Stan code

### A.1. Separate model

### A.2. Hierarchical model

## B. Loaded packages


# References
```{r include=FALSE}
# render("BDA_report_withcode.Rmd", output_format = "pdf_document")

```
